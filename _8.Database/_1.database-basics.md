# Основы баз данных

## Что такое база данных

База данных (БД) — это организованная коллекция структурированных данных, хранящихся и доступных в электронном виде. Базы данных предназначены для эффективного хранения, поиска и управления информацией.

### Ключевые понятия

- **Данные** — факты, которые можно записать и которые имеют неявное значение
- **База данных** — совокупность данных, организованных определенным образом
- **СУБД (Система управления базами данных)** — программное обеспечение для создания, хранения и управления базами данных
- **Схема базы данных** — структура или формальное описание типов данных в базе

## Типы баз данных

### По модели данных

1. **Реляционные БД**
   - Хранят данные в таблицах с отношениями между ними
   - Используют SQL для манипуляции данными
   - Примеры: MySQL, PostgreSQL, Oracle, SQL Server

2. **NoSQL БД**
   - **Документоориентированные**: MongoDB, CouchDB
   - **Ключ-значение**: Redis, DynamoDB
   - **Столбцовые**: Cassandra, HBase
   - **Графовые**: Neo4j, ArangoDB

3. **Объектно-ориентированные БД**
   - Хранят данные в виде объектов
   - Примеры: ObjectDB, db4o

4. **Иерархические БД**
   - Организуют данные в древовидной структуре
   - Примеры: IMS от IBM

### По назначению

1. **Операционные БД (OLTP)**
   - Предназначены для обработки транзакций в реальном времени
   - Оптимизированы для быстрого чтения и записи

2. **Аналитические БД (OLAP)**
   - Предназначены для сложного анализа данных
   - Оптимизированы для чтения и аналитических запросов

3. **Хранилища данных (Data Warehouses)**
   - Интегрируют данные из разных источников для анализа
   - Примеры: Snowflake, Amazon Redshift

## Фундаментальные концепции

### Структуры данных в БД

1. **Таблицы (реляционные БД)**
   - Состоят из строк (записей) и столбцов (полей)
   - Каждая таблица представляет один тип сущности

2. **Коллекции документов (документоориентированные БД)**
   - Документы со схожей структурой, но возможными вариациями
   - Каждый документ может иметь разный набор полей

3. **Пары ключ-значение (key-value БД)**
   - Простые структуры, где данные доступны по уникальному ключу

### Связи между данными

1. **Первичные ключи (Primary Keys)**
   - Уникально идентифицируют каждую запись в таблице

2. **Внешние ключи (Foreign Keys)**
   - Устанавливают связи между таблицами

3. **Типы связей**
   - Один к одному (1:1)
   - Один ко многим (1:N)
   - Многие ко многим (M:N)

## Основы работы с базами данных в Python

Python предоставляет множество библиотек для работы с различными базами данных.

### Работа с SQLite (встроенная в Python)

```python
import sqlite3

# Создание соединения с базой данных (или её создание, если не существует)
conn = sqlite3.connect('example.db')
cursor = conn.cursor()

# Создание таблицы
cursor.execute('''
CREATE TABLE IF NOT EXISTS users (
    id INTEGER PRIMARY KEY,
    name TEXT NOT NULL,
    email TEXT UNIQUE NOT NULL,
    age INTEGER
)
''')

# Вставка данных
cursor.execute("INSERT INTO users (name, email, age) VALUES (?, ?, ?)", 
              ("Иван Иванов", "ivan@example.com", 30))

# Сохранение изменений
conn.commit()

# Выполнение запроса
cursor.execute("SELECT * FROM users WHERE age > ?", (25,))
users = cursor.fetchall()
for user in users:
    print(f"ID: {user[0]}, Имя: {user[1]}, Email: {user[2]}, Возраст: {user[3]}")

# Закрытие соединения
conn.close()
```

### Работа с PostgreSQL через psycopg2

```python
import psycopg2

# Создание соединения
conn = psycopg2.connect(
    dbname="mydatabase",
    user="username",
    password="password",
    host="localhost",
    port="5432"
)
cursor = conn.cursor()

# Создание таблицы
cursor.execute('''
CREATE TABLE IF NOT EXISTS products (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    price DECIMAL(10, 2) NOT NULL,
    category VARCHAR(50)
)
''')

# Вставка данных с возвратом ID
cursor.execute("INSERT INTO products (name, price, category) VALUES (%s, %s, %s) RETURNING id", 
              ("Ноутбук", 45000.00, "Электроника"))
product_id = cursor.fetchone()[0]
print(f"Добавлен продукт с ID: {product_id}")

# Сохранение изменений
conn.commit()

# Закрытие соединения
conn.close()
```

### Работа с MongoDB через PyMongo

```python
from pymongo import MongoClient

# Создание соединения
client = MongoClient('mongodb://localhost:27017/')
db = client['mydatabase']
collection = db['users']

# Вставка документа
user = {
    "name": "Елена Петрова",
    "email": "elena@example.com",
    "age": 28,
    "hobbies": ["чтение", "плавание", "фотография"]
}
result = collection.insert_one(user)
print(f"Добавлен документ с ID: {result.inserted_id}")

# Поиск документов
users = collection.find({"age": {"$gt": 25}})
for user in users:
    print(f"Имя: {user['name']}, Возраст: {user['age']}")

# Обновление документа
collection.update_one(
    {"name": "Елена Петрова"},
    {"$set": {"age": 29}}
)

# Закрытие соединения
client.close()
```

## Основные операции с базами данных

### CRUD операции

- **Create** (Создание) — вставка новых данных
- **Read** (Чтение) — запрос и извлечение данных
- **Update** (Обновление) — изменение существующих данных
- **Delete** (Удаление) — удаление данных

### Примеры CRUD операций в SQL

```sql
-- Create
INSERT INTO employees (first_name, last_name, position, salary)
VALUES ('Алексей', 'Сидоров', 'Разработчик', 120000);

-- Read
SELECT * FROM employees WHERE salary > 100000;

-- Update
UPDATE employees SET position = 'Ведущий разработчик', salary = 150000
WHERE last_name = 'Сидоров';

-- Delete
DELETE FROM employees WHERE last_name = 'Сидоров';
```

## Нормализация баз данных

Нормализация — это процесс организации данных для минимизации избыточности и зависимостей.

### Нормальные формы

1. **Первая нормальная форма (1НФ)**
   - Данные атомарны (неделимы)
   - Каждая запись уникальна

2. **Вторая нормальная форма (2НФ)**
   - Соответствует 1НФ
   - Все неключевые атрибуты полностью зависят от первичного ключа

3. **Третья нормальная форма (3НФ)**
   - Соответствует 2НФ
   - Отсутствуют транзитивные зависимости (неключевые атрибуты не зависят от других неключевых атрибутов)

4. **Нормальная форма Бойса-Кодда (BCNF)**
   - Более строгая версия 3НФ

5. **Четвертая и пятая нормальные формы**
   - Решают проблемы с многозначными зависимостями и зависимостями соединения

## Преимущества и недостатки различных типов БД

### Реляционные БД

**Преимущества:**
- Структурированность и надежность
- ACID-совместимость
- Хорошо документированный стандарт SQL
- Зрелые технологии с многолетней историей

**Недостатки:**
- Сложности с горизонтальным масштабированием
- Жесткая схема данных
- Проблемы производительности при очень больших объемах данных

### NoSQL БД

**Преимущества:**
- Гибкость схемы (или её отсутствие)
- Хорошее горизонтальное масштабирование
- Высокая производительность для определенных типов данных
- Работа с неструктурированными данными

**Недостатки:**
- Часто отсутствие полной поддержки ACID
- Отсутствие стандартизированного языка запросов
- Меньше инструментов для анализа данных
- Потенциальные проблемы с согласованностью данных

## Выбор базы данных для проекта

При выборе типа базы данных следует учитывать:

1. **Структуру данных**
   - Если данные имеют четкую структуру и связи — реляционная БД
   - Если структура изменчива или разнородна — NoSQL

2. **Объемы данных и нагрузку**
   - Для очень больших объемов данных и высоких нагрузок часто подходят NoSQL решения

3. **Требования к согласованности данных**
   - Если критична согласованность — реляционные БД с ACID поддержкой
   - Если важнее доступность — NoSQL с моделью согласованности в конечном счете (eventual consistency)

4. **Масштабируемость**
   - Горизонтальное масштабирование проще с NoSQL базами

5. **Поддержка и экосистема**
   - Наличие специалистов
   - Доступность библиотек и инструментов

## Современные тенденции в базах данных

1. **NewSQL** — базы данных, сочетающие преимущества SQL и NoSQL
   - CockroachDB, Google Spanner

2. **Базы данных в памяти (In-memory)**
   - Redis, Memcached, Apache Ignite

3. **Временные ряды (Time-series)**
   - InfluxDB, TimescaleDB

4. **Распределенные базы данных**
   - CockroachDB, Cassandra, Citus

5. **Графовые базы данных**
   - Neo4j, ArangoDB, Amazon Neptune

6. **Многомодельные базы данных**
   - FaunaDB, ArangoDB, OrientDB
