# Паттерн Prototype (Прототип)

## Описание

Прототип — это порождающий паттерн проектирования, который позволяет копировать объекты, не вдаваясь в подробности их реализации. Паттерн Прототип делегирует процесс клонирования самим клонируемым объектам, объявляя общий интерфейс для всех объектов, поддерживающих клонирование.

## Когда использовать

- Когда ваш код не должен зависеть от классов копируемых объектов
- Когда нужно создавать копии объектов с вариативным набором состояний, которые трудно задать через конструктор
- Когда вы хотите создавать объекты на основе других объектов "на лету"
- Когда создание объекта дороже, чем его копирование
- Когда экземпляры класса могут иметь ограниченное количество комбинаций состояний

## Преимущества

- Позволяет клонировать объекты без привязки к их конкретным классам
- Сокращает повторяющийся код инициализации объектов
- Ускоряет создание объектов (копирование часто быстрее создания с нуля)
- Предоставляет альтернативу созданию подклассов для конфигурирования объектов
- Можно клонировать сложные объекты с частными (private) полями

## Недостатки

- Сложно клонировать составные объекты с циклическими ссылками
- Может быть трудно реализовать глубокое копирование объектов со сложными связями
- В некоторых случаях создание правильной копии объекта может быть сложным

## Реализация на Python

Python предоставляет встроенный модуль `copy` для реализации паттерна прототип:

```python
import copy

class Prototype:
    def __init__(self):
        self.objects = {}
    
    def register(self, name, obj):
        self.objects[name] = obj
    
    def unregister(self, name):
        del self.objects[name]
    
    def clone(self, name, **kwargs):
        obj_clone = copy.deepcopy(self.objects.get(name))
        obj_clone.__dict__.update(kwargs)
        return obj_clone

# Пример использования
class Document:
    def __init__(self, name, category, content=""):
        self.name = name
        self.category = category
        self.content = content
        self.authors = []
    
    def add_author(self, author):
        self.authors.append(author)
    
    def __str__(self):
        return f"{self.name} ({self.category}) - {len(self.authors)} authors, {len(self.content)} chars"

# Использование реестра прототипов
document_prototype = Prototype()

# Создание и регистрация базовых прототипов
template_report = Document("Report", "Business", "This is a report template")
template_report.add_author("Admin")
document_prototype.register("report", template_report)

template_article = Document("Article", "Science", "This is an article template")
template_article.add_author("Editor")
document_prototype.register("article", template_article)

# Клонирование и настройка
johns_report = document_prototype.clone("report", name="John's Report", content="Quarterly sales data")
johns_report.add_author("John Smith")

# Еще один вариант реализации через методы классов
class CustomDocument:
    def __init__(self, title, content, style=None):
        self.title = title
        self.content = content
        self.style = style or {}
    
    def clone(self):
        # Создание глубокой копии
        return copy.deepcopy(self)
    
    def __str__(self):
        return f"Document: {self.title}, Style: {self.style}"
```

## Где применяется в реальных проектах

- Создание сложных графических объектов (в редакторах и графических приложениях)
- Работа с шаблонами документов (при необходимости создания вариаций)
- Кэширование объектов для повышения производительности
- Инициализация объектов с определенным состоянием для тестирования
- Конфигурации программ и систем
- Создание предопределенных объектов в играх и симуляциях
- Фабрики объектов, использующие прототипы как шаблоны

## Связанные паттерны

- **Абстрактная фабрика**: Может использовать Прототип для создания объектов
- **Компоновщик**: Прототип позволяет копировать сложные древовидные структуры
- **Декоратор**: Можно использовать Прототип для клонирования декорированных объектов
- **Команда**: Прототип может помочь в создании копий команд для истории операций
- **Memento**: Прототип можно использовать для создания снимков состояния объектов

## Рекомендации по использованию

- В Python удобно использовать встроенный модуль `copy` с функциями `copy` (поверхностное копирование) и `deepcopy` (глубокое копирование)
- Определите, нужно ли вам глубокое копирование (все вложенные объекты) или достаточно поверхностного
- При необходимости создайте реестр прототипов для централизованного управления
- Обратите внимание на копирование объектов с циклическими ссылками
- Для сложных объектов может потребоваться реализация собственных методов `__copy__` и `__deepcopy__`
- В некоторых случаях сериализация/десериализация может быть альтернативой глубокому копированию

